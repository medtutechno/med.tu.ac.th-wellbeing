<template>
  <div class="assessment-result" v-if="results">
    <div class="container py-5">
      <div class="wizard-v1-content">
        <div class="wizard-form">
          <div class="document_1">
            <h3>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï DASS-21</h3>
          </div>
          <div class="user-info mb-4">
            <div class="info-grid">
              <div class="info-item">
                <span><i class="fas fa-user me-2"></i>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: {{ assessmentData?.fullname }}</span>
              </div>
              <div class="info-item">
                <span><i class="fas fa-id-card me-2"></i>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤: {{ assessmentData?.studentId }}</span>
              </div>
              <div class="info-item">
                <span><i class="fas fa-graduation-cap me-2"></i>‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: {{ assessmentData?.year === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ? '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' : '‡∏õ‡∏µ ' + assessmentData?.year }}</span>
              </div>
              <div class="info-item">
                <span><i class="fas fa-book me-2"></i>‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£: {{ assessmentData?.program }}</span>
              </div>
              <div class="info-item">
                <span><i class="fas fa-envelope me-2"></i>‡∏≠‡∏µ‡πÄ‡∏°‡∏•: {{ assessmentData?.email }}</span>
              </div>
              <div class="info-item">
                <span><i class="fas fa-phone me-2"></i>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå: {{ assessmentData?.phone }}</span>
              </div>
            </div>
          </div>
          <br>

          <div class="row">
            <!-- Depression Result -->
            <div class="col-md-4 mb-4">
              <div class="result-section h-100">
                <div class="card">
                  <div class="card-header text-center">
                    <strong>‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤ {{ getResults[0].score }} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>
                  </div>
                  <div class="card-body text-center">
                    <i :class="['far', 'fa-4x', 'mb-3', getEmotionIcon(getResults[0].level), getTextColorClass(getResults[0].level)]"></i>
                    <div v-if="getResults && getResults[0]" :class="['mt-3', getTextColorClass(getResults[0].level)]">
                      <h3>{{ getLevelText(0, getResults[0].level) }}</h3>
                      <p>{{ getResultText('depression', getResults[0].level) }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Anxiety Result -->
            <div class="col-md-4 mb-4">
              <div class="result-section h-100">
                <div class="card">
                  <div class="card-header text-center">
                    <strong>‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏• {{ getResults[1].score }} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>
                  </div>
                  <div class="card-body text-center">
                    <i :class="['far', 'fa-4x', 'mb-3', getEmotionIcon(getResults[1].level), getTextColorClass(getResults[1].level)]"></i>
                    <div v-if="getResults && getResults[1]" :class="['mt-3', getTextColorClass(getResults[1].level)]">
                      <h3>{{ getLevelText(1, getResults[1].level) }}</h3>
                      <p>{{ getResultText('anxiety', getResults[1].level) }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Stress Result -->
            <div class="col-md-4 mb-4">
              <div class="result-section h-100">
                <div class="card">
                  <div class="card-header text-center">
                    <strong>‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î {{ getResults[2].score }} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</strong>
                  </div>
                  <div class="card-body text-center">
                    <i :class="['far', 'fa-4x', 'mb-3', getEmotionIcon(getResults[2].level), getTextColorClass(getResults[2].level)]"></i>
                    <div v-if="getResults && getResults[2]" :class="['mt-3', getTextColorClass(getResults[2].level)]">
                      <h3>{{ getLevelText(2, getResults[2].level) }}</h3>
                      <p>{{ getResultText('stress', getResults[2].level) }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div v-if="shouldTake8Q" class="alert alert-danger mt-4">
            <h5 class="alert-heading">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° - ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏Ü‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏¢</h5>
            <p>‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ü‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏¢ 8Q ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°</p>
            <router-link to="/assessment/8q" class="btn btn-danger mt-2">
              ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 8Q
            </router-link>
          </div>

          <div v-else-if="shouldTake9Q" class="alert alert-warning mt-4 d-none">
            <h5 class="alert-heading">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h5>
            <p>‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤ 9Q ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
            <router-link to="/assessment/9q" class="btn btn-primary mt-2">
              ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 9Q
            </router-link>
          </div>

          <div v-else-if="hasRisk" class="mt-4 d-none">
            <div class="alert alert-warning mb-3">
              <h5 class="alert-heading">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h5>
              <p>‡∏à‡∏≤‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡πà‡∏≤‡∏ô‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</p>
            </div>
            <div class="text-center">
              <router-link to="/booking" class="btn btn-primary btn-lg mb-3">
                <i class="fas fa-calendar-check me-2"></i>‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏ö‡∏±‡∏î
              </router-link>
            </div>
          </div>

          <div class="text-center mt-3">
            <router-link to="/" class="btn btn-outline-secondary">
              ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </router-link>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-5" v-if="assessmentData && assessmentData.nineQ">
    <div class="card">
      <div class="card-body">
        <h2 class="card-title text-center mb-4">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô 9Q</h2>
        
        <div v-if="getNineQResult()" :class="['alert', getNineQResult().class]">
          <h4 class="alert-heading">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: {{ getNineQResult().score }}</h4>
          <p class="mb-0">{{ getNineQResult().text }}</p>
        </div>

        <div class="mt-4">
          <h5>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</h5>
          <ul class="list-group">
            <li class="list-group-item" v-if="getNineQResult().score < 7">
              ‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠
            </li>
            <li class="list-group-item" v-if="getNineQResult().score >= 7 && getNineQResult().score < 13">
              ‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢
            </li>
            <li class="list-group-item" v-if="getNineQResult().score >= 13">
              ‡∏ó‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°
            </li>
          </ul>
        </div>

        <div class="text-center mt-4">
          <router-link to="/" class="btn btn-success btn-lg">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</router-link>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import store from '@/store/assessment'
import { submitTestResults, sendTelegramNotification } from '@/services/assessmentService'

export default {
  name: 'AssessmentResult',
  data() {
    return {
      results: [
        {
          name: 'depression',
          title: '‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤',
          ranges: {
            normal: [0, 4],
            mild: [5, 6],
            moderate: [7, 10],
            severe: [11, 13],
            extremely_severe: [14, 21]
          },
          levels: {
            normal: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ (Normal)',
            mild: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (Mild)',
            moderate: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Moderate)',
            severe: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (Severe)',
            extremely_severe: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å (Extremely Severe)'
          }
        },
        {
          name: 'anxiety',
          title: '‡∏î‡πâ‡∏≤‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•',
          ranges: {
            normal: [0, 3],
            mild: [4, 5],
            moderate: [6, 7],
            severe: [8, 9],
            extremely_severe: [10, 21]
          },
          levels: {
            normal: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏õ‡∏Å‡∏ï‡∏¥ (Normal)',
            mild: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (Mild)',
            moderate: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Moderate)',
            severe: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (Severe)',
            extremely_severe: '‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å (Extremely Severe)'
          }
        },
        {
          name: 'stress',
          title: '‡∏î‡πâ‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î',
          ranges: {
            normal: [0, 7],
            mild: [8, 9],
            moderate: [10, 12],
            severe: [13, 16],
            extremely_severe: [17, 21]
          },
          levels: {
            normal: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (Normal)',
            mild: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (Mild)',
            moderate: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (Moderate)',
            severe: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á (Severe)',
            extremely_severe: '‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏°‡∏≤‡∏Å (Extremely Severe)'
          }
        }
      ],
      isSubmitting: false,
      submitError: null
    }
  },
  computed: {
    assessmentData() {
      return store.state.assessmentData
    },
    is8QAssessment() {
      return this.$route.query.type === '8q'
    },
    getResults() {
      if (!this.assessmentData?.scores) return [];
      
      return [
        {
          type: 'depression',
          score: this.assessmentData.scores.depression,
          level: this.getLevel('depression', this.assessmentData.scores.depression)
        },
        {
          type: 'anxiety',
          score: this.assessmentData.scores.anxiety,
          level: this.getLevel('anxiety', this.assessmentData.scores.anxiety)
        },
        {
          type: 'stress',
          score: this.assessmentData.scores.stress,
          level: this.getLevel('stress', this.assessmentData.scores.stress)
        }
      ];
    },
    shouldTake8Q() {
      const depressionScore = this.getResults[0]?.score || 0;
      const anxietyScore = this.getResults[1]?.score || 0;
      const stressScore = this.getResults[2]?.score || 0;

      // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏†‡∏≤‡∏ß‡∏∞‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤ (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô > 14)
      const severeDepression = depressionScore > 14;
      
      // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏• (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô > 10)
      const severeAnxiety = anxietyScore > 10;
      
      // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î (‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô > 17)
      const severeStress = stressScore > 17;

      // ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ 8Q ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏†‡∏≤‡∏ß‡∏∞‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á
      return severeDepression || severeAnxiety || severeStress;
    },
    shouldTake9Q() {
      // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥ 8Q ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ 8Q ‡∏Å‡πà‡∏≠‡∏ô
      if (this.shouldTake8Q) {
        return false;
      }
      const depressionScore = this.getResults[0]?.score || 0;
      return depressionScore >= 7;
    },
    hasRisk() {
      if (!this.getResults) return false;
      return this.getResults.some(result => {
        if (result.type === 'depression') return result.score >= 14;
        if (result.type === 'anxiety') return result.score >= 10;
        if (result.type === 'stress') return result.score >= 17;
        return false;
      });
    }
  },
  methods: {
    getLevel(type, score) {
      const result = this.results.find(r => r.name === type);
      if (!result) return 'normal';
      
      const { ranges } = result;
      
      if (score >= ranges.extremely_severe[0]) return 'extremely_severe';
      if (score >= ranges.severe[0]) return 'severe';
      if (score >= ranges.moderate[0]) return 'moderate';
      if (score >= ranges.mild[0]) return 'mild';
      return 'normal';
    },
    getEmotionIcon(level) {
      switch (level) {
        case 'normal':
          return 'fa-face-smile';
        case 'mild':
          return 'fa-face-meh';
        case 'moderate':
          return 'fa-face-frown';
        case 'severe':
          return 'fa-face-sad-tear';
        case 'extremely_severe':
          return 'fa-face-sad-cry';
        default:
          return 'fa-face-meh';
      }
    },
    getLevelText(index, level) {
      if (!this.results[index]) return '';
      return this.results[index].levels[level];
    },
    getTextColorClass(level) {
      switch (level) {
        case 'normal':
          return 'text-success';
        case 'mild':
          return 'text-warning';
        case 'moderate':
          return 'text-orange';
        case 'severe':
        case 'extremely_severe':
          return 'text-danger';
        default:
          return '';
      }
    },
    getResultText(type, level) {
      const result = this.results.find(r => r.name === type);
      if (!result?.levels?.[level]) return '';
      return result.levels[level];
    },
    get8QEmotionIcon(riskLevel) {
      switch (riskLevel) {
        case '‡∏ô‡πâ‡∏≠‡∏¢':
          return 'fa-smile'
        case '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á':
          return 'fa-meh'
        case '‡∏™‡∏π‡∏á':
          return 'fa-frown'
        case '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å':
          return 'fa-sad-tear'
        default:
          return 'fa-meh'
      }
    },
    get8QTextColorClass(riskLevel) {
      switch (riskLevel) {
        case '‡∏ô‡πâ‡∏≠‡∏¢':
          return 'text-success'
        case '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á':
          return 'text-warning'
        case '‡∏™‡∏π‡∏á':
          return 'text-danger'
        case '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å':
          return 'text-danger'
        default:
          return 'text-warning'
      }
    },
    get8QRecommendation(riskLevel) {
      switch (riskLevel) {
        case '‡∏ô‡πâ‡∏≠‡∏¢':
          return '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≥ ‡πÉ‡∏´‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏´‡πà‡∏≤‡∏á‡πÜ'
        case '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á':
          return '‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤'
        case '‡∏™‡∏π‡∏á':
          return '‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÇ‡∏î‡∏¢‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤'
        case '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å':
          return '‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÇ‡∏î‡∏¢‡∏ó‡∏±‡∏ô‡∏ó‡∏µ'
        default:
          return '‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'
      }
    },
    getNineQResult() {
      if (!this.assessmentData || !this.assessmentData.nineQ) return null;
      const score = this.assessmentData.nineQ.total;
      const level = this.getNineQLevel(score);
      return {
        score,
        class: level === 0 ? 'alert-success' : level === 1 ? 'alert-warning' : 'alert-danger',
        text: this.getNineQText(level)
      };
    },
    getNineQLevel(score) {
      if (score >= 19) return 3; // Severe
      if (score >= 13) return 2; // Moderate
      if (score >= 7) return 1;  // Mild
      return 0; // Normal
    },
    getNineQText(level) {
      const texts = {
        0: '‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏ô‡πâ‡∏≠‡∏¢‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏î‡∏π‡πÅ‡∏•‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠',
        1: '‡∏ó‡πà‡∏≤‡∏ô‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢',
        2: '‡∏ó‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏£‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°'
      }
      return texts[level]
    },
    getChoiceText(choice) {
      const choices = {
        0: '‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡πÄ‡∏•‡∏¢',
        1: '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
        2: '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡∏°‡∏≤‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡πà‡∏≠‡∏¢',
        3: '‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏â‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤'
      };
      return choices[choice] || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö';
    },
    async submitResults() {
      if (this.isSubmitting) return

      try {
        this.isSubmitting = true
        this.submitError = null

        const data = {
          name: this.assessmentData?.fullname,
          
      student_id: this.assessmentData?.studentId,
        year: this.assessmentData?.year,
        program: this.assessmentData?.program,
        email: this.assessmentData?.email,
        phone_number: this.assessmentData?.phone,
        
          dass21_result: JSON.stringify({
            scores: this.assessmentData?.scores,
            summary: this.assessmentData?.summary
          }),
          dass21_depression_score: this.assessmentData?.scores?.depression,
          dass21_anxiety_score: this.assessmentData?.scores?.anxiety,
          dass21_stress_score: this.assessmentData?.scores?.stress,
          dass21_score: this.assessmentData?.scores?.depression + this.assessmentData?.scores?.anxiety + this.assessmentData?.scores?.stress,
          eightq_score: null,
          eightq_result: null
        }

        await submitTestResults(data)
        console.log('Test results submitted successfully')
      } catch (error) {
        console.error('Failed to submit test results:', error)
        this.submitError = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á'
      } finally {
        this.isSubmitting = false
      }
    },
    shouldSubmitResults() {
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ 8Q
      const { depression, anxiety, stress } = this.assessmentData?.scores || {}
      
      // ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ 8Q (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á)
      return (
        depression < 21 && // ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á
        anxiety < 15 &&    // ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á
        stress < 26        // ‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á
      )
    },
    async sendNotification() {
      try {
        const { depression, anxiety, stress } = this.assessmentData?.scores || {}
        const studentInfo = `üë®‚Äçüéì ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤: ${this.assessmentData?.fullname}, üÜî ‡∏£‡∏´‡∏±‡∏™: ${this.assessmentData?.studentId}, üìö ‡∏ä‡∏±‡πâ‡∏ô‡∏õ‡∏µ: ${this.assessmentData?.year}, üè´ ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£: ${this.assessmentData?.program}`
        const scoreInfo = `üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô DASS-21: üò¢ ‡∏ã‡∏∂‡∏°‡πÄ‡∏®‡∏£‡πâ‡∏≤=${depression}, üò∞ ‡∏ß‡∏¥‡∏ï‡∏Å‡∏Å‡∏±‡∏á‡∏ß‡∏•=${anxiety}, üò´ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î=${stress}`
        const message = `‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ${studentInfo}\n${scoreInfo}\n‚úÖ ‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ`
        
        await sendTelegramNotification(message)
        console.log('Telegram notification sent successfully')
      } catch (error) {
        console.error('Failed to send Telegram notification:', error)
      }
    }
  },
  mounted() {
    if (!this.assessmentData) {
      this.$router.push('/assessment')
      return
    }

    // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡∏∂‡∏á‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ 8Q ‡πÉ‡∏´‡πâ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 8Q ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    if (this.shouldTake8Q) {
      this.$router.push('/assessment/8q')
      return
    }

    // Log complete assessment data including DASS-21 summary
    console.log('Complete Assessment Data:', JSON.stringify({
      DASS21: this.assessmentData.summary,
      scores: this.assessmentData.scores,
      answers: this.assessmentData.answers
    }, null, 2))

    // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏ú‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á API
    if (this.shouldSubmitResults()) {
      this.submitResults()
      this.sendNotification()
    }
  }
}
</script>

<style scoped>
.assessment-result {
  padding-top: 80px;
  min-height: 100vh;
  background-color: #f8f9fa;
}

.wizard-v1-content {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  padding: 2rem;
}

.result-text {
  font-size: 1.1em;
  font-weight: 500;
}

.card {
  height: 100%;
  border: 1px solid rgba(0,0,0,.125);
  box-shadow: 0 2px 4px rgba(0,0,0,.05);
}

.card-header {
  background-color: #f8f9fa;
  border-bottom: 1px solid rgba(0,0,0,.125);
  padding: 1rem;
}

.card-body {
  padding: 1.5rem;
}

.result-section i {
  margin-bottom: 1rem;
}

.text-orange {
  color: #fd7e14;
}

.result-section {
  max-width: 800px;
  margin: 0 auto;
}

table {
  background-color: white;
}

.table td {
  vertical-align: middle;
}

.text-success {
  color: #28a745 !important;
}

.text-warning {
  color: #ffc107 !important;
}

.text-danger {
  color: #dc3545 !important;
}

@media (max-width: 768px) {
  .card {
    margin-bottom: 1rem;
  }
}

.user-info {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 15px;
}

.info-item {
  padding: 8px;
}

.info-item span {
  display: flex;
  align-items: center;
  color: #495057;
}

.info-item i {
  color: var(--home4-primary);
  width: 20px;
}
</style>
